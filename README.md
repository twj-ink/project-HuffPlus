# HuffPlus 压缩/解压软件设计说明书

## 1. 项目概述

### 1.1 背景

Huffman 编码是一种经典的无损压缩算法。本项目的目标是将 Huffman 编码扩展为一个完整的**压缩/解压软件**，支持文件和目录压缩，能够处理大文件，并采用插件式架构，以便轻松扩展其他压缩算法。

### 1.2 项目目标

* 实现基于 Huffman 编码的文件压缩与解压。
* 支持文件文本和二进制文件。
* 支持单个文件和目录的压缩/解压。
* 支持大文件（> 1GB）的分块压缩与解压。
* 提供插件式构架，便于扩展更多压缩算法。
* 提供命令行工具。


## 2. 需求分析

### 2.1 功能需求

1. 文件压缩/解压

* 输入：文件或目录
* 输出：自定义格式 .huffp 文件
* 解压后还原原始文件/目录

2. 多文件/目录支持

* 支持递归压缩目录
* 解压时还原目录层级

3. 大文件支持
   
* 采用分块压缩，避免内存溢出
* 每个分块单独存储，解压时按顺序恢复

4. 插件式架构

* 核心程序只依赖接口，不绑定具体算法
* 压缩算法以插件形式加载（如 `.so` / `.dll`）

5. 命令行工具

* `compress`：压缩文件/目录
* `decompress`：解压缩文件
* `list`：查看压缩包内容
* `--algorithm`：指定压缩算法
   
### 2.2 非功能需求

1. 性能：能处理 1GB 以上文件
2. 兼容性：跨平台（Linux/Windows）
3. 可扩展性：支持多种压缩算法
4. 健壮性：错误处理（文件不存在、损坏文件等）
5. 安全性：校验和验证文件完整性
   
## 3. 系统架构设计

### 3.1 总体架构

### 3.2 文件格式设计(`.huffp`)

1. 文件头（Header）
* Magic number： `HUFF+`
* 版本号：`1.0`
* 算法标识：Huffman
* 原始文件大小
* 压缩后大小
* 校验和（CRC32）
2. 文件原信息
* 文件名
* 文件路径
* 修改时间戳
3. 数据块（Data Blocks）
* 压缩后的内容，支持分块
4. 索引表（Footer）
* 目录结构树
* 快速定位文件内容

## 4. 模块设计

## 5. 流程设计

### 5.1 压缩流程

输入文件/目录 $\rightarrow$ 扫描目录，收集元数据 $ \rightarrow $ 写入文件头 $ \rightarrow $ 逐文件读取数据、分块、压缩、写入数据块 $ \rightarrow $ 生成索引表，写入尾部 $ \rightarrow $ 生成完成 `.huffp` 文件

### 5.2 解压流程

读取 `.huffp` 文件 $ \rightarrow $ 解析文件头，确认算法 $ \rightarrow $ 读取索引表，还原目录结构 $ \rightarrow $ 逐文件逐块解压缩 $ \rightarrow $ 输出文件

## 6 技术选型

* 语言：C++
* 构建工具：CMAKE
* 插件机制：动态库（`.so`/`.dll`）
* 异步I/O：Linux io_uring / Windows Overlapped I/O
* 单元测试：GoogleTest

## 7 测试计划

### 7.1 功能测试

* 单文件压缩/解压
* 目录压缩/解压
* 大文件压缩/解压

### 7.2 性能测试

* 压缩 1GB 文件，统计耗时与压缩比

### 7.3 容错测试

* 输入不存在文件/目录
* 错误的压缩包

## 8 项目计划

| 阶段  | 时间    | 内容                 |
| --- | ----- | ------------------ |
| 阶段1 | 第1-2周 | Huffman 算法实现，单文件压缩 |
| 阶段2 | 第3周   | 支持目录，文件格式 `.huffp` |
| 阶段3 | 第4-5周 | 大文件支持，多线程，异步 I/O   |
| 阶段4 | 第6周   | 插件式架构，扩展一个新算法      |
| 阶段5 | 第7周   | CLI 工具，用户文档        |
| 阶段6 | 第8周   | 测试，性能优化，总结         |
